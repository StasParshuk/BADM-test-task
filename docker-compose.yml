version: '3.7'

services:

    dev_php:
        build: deployment/php/dev
        working_dir: /usr/src/app
        volumes:
            - .:/usr/src/app
            - ./deployment/config/uploads.ini:/usr/local/etc/php/conf.d/uploads.ini:ro
        environment:
            XDEBUG_CONFIG: "remote_host=192.168.220.1 remote_enable=1"
            PHP_IDE_CONFIG: "serverName=Docker"
        links:
            - "dev_db:db"
            - "dev_redis:redis"
        networks:
            - internal

    dev_web:
        image: nginx:stable
        working_dir: /usr/src/app
        ports:
            - "8080:8080"
        volumes:
            - .:/usr/src/app
            - ./nginx_log:/var/log/nginx
            - ./deployment/config/default.dev.conf:/etc/nginx/conf.d/default.conf:ro
        links:
            - "dev_php:php"
        networks:
            - internal

    dev_db:
        image: postgres:11.1
        ports:
            - "5433:5432"
        volumes:
            - ./database_data:/var/lib/postgresql/data
        environment:
            POSTGRES_ROOT_PASSWORD: EtSKF84a7nWS
            POSTGRES_DB: symfony
            POSTGRES_USER: symfony
            POSTGRES_PASSWORD: EtSKF84a7nWS
        networks:
            - internal


    dev_redis:
        networks:
            - internal
        image: redis:7.0-alpine
        ports:
            - "6379"

networks:
    internal:
        driver: bridge
        ipam:
            driver: default
